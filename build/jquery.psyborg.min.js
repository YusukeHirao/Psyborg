/**
 * Psyborg.js - v0.4.3 r826
 * update: 2014-05-02
 * Author: Yusuke Hirao [http://www.yusukehirao.com]
 * Github: https://github.com/YusukeHirao/Psyborg
 * License: Licensed under the MIT License
 * Require: jQuery v1.11.0 or later
 */

var __extends=this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},PsyborgWindow=function(){function a(){}return a.linkTo=function(a,b){switch("undefined"==typeof b&&(b=""),b){case"_blank":window.open(a,null);break;default:location.href=a}},a}(),PsyborgEvent=function(){function a(a){this.defaultPrevented=!1,this.type=a,this.timeStamp=(new Date).valueOf()}return a.prototype.preventDefault=function(){this.defaultPrevented=!0},a}(),PsyborgEventDispacther=function(){function a(){this._listeners={}}return a.prototype.on=function(a,b){for(var c=a.split(/\s+/),d=0,e=c.length;e>d;d++)this._listeners[c[d]]||(this._listeners[c[d]]=[]),this._listeners[c[d]].push(b)},a.prototype.off=function(a,b){for(var c,d=a.split(/\s+/),e=0,f=d.length;f>e;e++)c=d[e],(null==b||this._listeners[c]===b)&&delete this._listeners[c]},a.prototype.trigger=function(a,b,c){"undefined"==typeof b&&(b={}),"undefined"==typeof c&&(c=this);var d,e,f=0;if(this._listeners[a])for(e=this._listeners[a].length;e>f;f++){d=this._listeners[a][f];var g=new PsyborgEvent(a);if(g.data=b,d.call(c,g),g.defaultPrevented)return!1}return!0},a}(),PsyborgUtil=function(){function a(){}return a.getSpeed=function(a,b){return a/b},a.getDuration=function(a,b){return a/b},a.getDistance=function(a,b){return a*b},a.getloopSeriesNumber=function(a,b){var c;return c=a%b,0===c?c:(0>a&&(c=b+Math.abs(a)%b*-1),c)},a.getloopSeriesVector=function(b,c,d,e){var f,g,h,i,j=0/0;if(0!==d&&1!==d&&-1!==d)throw new RangeError("`direction` is must 1 or -1 or zero.");return 0===d?(b=a.getloopSeriesNumber(b,e),c=a.getloopSeriesNumber(c,e),j=c>b?c-e:c+e,g=Math.abs(c-b),h=Math.abs(j-b),i=Math.min(g,h),f=g===i?b>c?-1*g:g:b>j?-1*h:h):b===c?f=e*d:c>b&&-1===d?(c=a.getloopSeriesNumber(c,e),j=c-e,f=j-b):b>c&&1===d?(c=a.getloopSeriesNumber(c,e),j=c+e,f=j-b):f=c-b,f},a}(),PsyborgCSS=function(){function a(){}return a.posAbs=function(a,b,c){return"undefined"==typeof b&&(b=0),"undefined"==typeof c&&(c=0),a.css({position:"absolute",top:b,left:c})},a.posBase=function(a){var b=a.css("position");return(null==b||"static"===b||""===b)&&a.css({position:"relative"}),a},a.z=function(a,b){return"undefined"==typeof b&&(b=0),a.css({zIndex:b}),a},a.isOverflowHidden=function(a){return"hidden"===a.css("overflow").toLowerCase()},a.saveCSS=function(a){a.each(function(a,b){var c=$(b);c.data("originStyle",c.attr("style"))})},a.restoreCSS=function(a){a.each(function(a,b){var c=$(b);c.attr("style",c.data("originStyle"))})},a}(),PsyborgElement=function(a){function b(b){if(a.call(this),!b.length)throw new ReferenceError('This jQuery object is empty. Selector "'+b.selector+"\" doesn't exist.");this.$el=b}return __extends(b,a),b.prototype.trigger=function(b,c,d){"undefined"==typeof c&&(c={}),"undefined"==typeof d&&(d=this);var e=a.prototype.trigger.call(this,b,c,d);return e&&this.$el.trigger(b,c,d),e},b.prototype.getWidth=function(){return this.$el.width()},b.prototype.getHeight=function(){return this.$el.height()},b.prototype.setWidth=function(a){return this.$el.width(a),this},b.prototype.setHeight=function(a){return this.$el.height(a),this},b}(PsyborgEventDispacther),PsycleRepeat=function(){function a(){}return a.NONE="none",a.RETURN="return",a.LOOP="loop",a}(),PsycleEvent=function(){function a(){}return a.INIT="init",a.PANEL_CHANGE_START="panelChangeStart",a.PANEL_CHANGE_END="panelChangeEnd",a.PANEL_CHANGE_CANCEL="panelChangeCancel",a.WAIT_START="waitStart",a.WAIT_END="waitEnd",a}(),PsycleReflowTiming=function(){function a(){}return a.INIT="init",a.TRANSITION_END="transitionEnd",a.RESIZE="resize",a.RESIZE_START="resizeStart",a.RESIZE_END="resizeEnd",a.REFLOW_METHOD="reflowMethod",a}(),PsyclePanel=function(a){function b(b,c,d){a.call(this,b),this.index=c,this._list=d}return __extends(b,a),b.prototype.show=function(){return this.$el.show(),this},b.prototype.hide=function(){return this.$el.hide(),this},b.prototype.clone=function(){var a=new PsyclePanelClone(this.$el.clone(),this.index,this._list);return this.$el.after(a.$el),this._list.addClone(a),a},b}(PsyborgElement),PsyclePanelClone=function(a){function b(b,c,d){a.call(this,b,c,d)}return __extends(b,a),b}(PsyclePanel),PsyclePanelList=function(a){function b(b){a.call(this,b),this._panels=[],this._$panels=$(),this._clones=[],this.length=0;for(var c,d=0,e=b.length;e>d;d++)c=$(b[d]),this.add(c)}return __extends(b,a),b.prototype.setCurrent=function(a,b){return this.resetCurrent(b),this.item(a).$el.addClass(b),this},b.prototype.resetCurrent=function(a){return this.$el.removeClass(a),this},b.prototype.add=function(a){var b=this._panels.length,c=new PsyclePanel(a,b,this);return this._panels.push(c),this.$el=this.$el.add(a),this.length+=1,this},b.prototype.addClone=function(a){return this._clones.push(a),this},b.prototype.remove=function(a,b){return"undefined"==typeof b&&(b=!0),b&&this.$el.eq(a).remove(),this._panels.splice(a,1),this._renumbering(),this.length-=1,this},b.prototype.item=function(a){var b=this._getRealIndex(a);return this._panels[b]},b.prototype.each=function(a){for(var b,c=0,d=this._panels.length;d>c;c++)b=this._panels[c],a.call(b,b.index,b);return this},b.prototype.show=function(){return this.$el.show(),this},b.prototype.hide=function(){return this.$el.hide(),this},b.prototype.removeClone=function(){for(var a=0,b=this._clones.length;b>a;a++)this._clones[a].$el.remove();return this._clones=[],this},b.prototype._getRealIndex=function(a){var b=this._panels.length;a%=b;var c=0>a?b+a:a;return c},b.prototype._renumbering=function(){for(var a=0,b=this._panels.length;b>a;a++)this._panels[a].index=a;return b},b}(PsyborgElement),PsycleContainer=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b}(PsyborgElement),PsycleStage=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b}(PsyborgElement),PsycleTransition=function(){function a(a,b){this.name=a,$.extend(this,b)}return a.create=function(b){var c,d;for(c in b)d=new a(c,b[c]),a.transitions[c]=d},a.transitions={},a}();PsycleTransition.create({slide:{init:function(){var a=this;PsyborgCSS.posBase(this.stage.$el),PsyborgCSS.posAbs(this.container.$el),PsyborgCSS.posAbs(this.panels.$el);var b=this.panels.$el;PsyborgCSS.saveCSS(b);var c,d,e,f,g,h=!1,i=!1;this._config.draggable&&(e=this.stage.$el.hammer({drag_block_horizontal:!0,tap_always:!1,swipe_velocity:.1}),e.find("a, img").hammer({drag_block_horizontal:!0,tap_always:!1}),this.panels.each(function(a,b){var c,d,e=b.$el.hammer(),f=e.find("a");f.length&&(f.on("click",function(a){a.preventDefault()}),c=f.prop("href"),d=f.prop("target"),e.on("tap",function(){c&&PsyborgWindow.linkTo(c,d)}))}),e.on("tap dragstart drag dragend",function(b){switch(b.type){case"tap":!function(){h=!1}();break;case"dragstart":!function(){c=a.container.$el.position().left,g=a.index}();break;case"drag":!function(){var d=b.gesture.deltaX,e=c+d;a.freeze(),h=!0,a.container.$el.css({left:e})}();break;case"dragend":!function(){var d=b.gesture.deltaX,e=a.panelWidth,g=c+d,j=a.panelWidth%f,k=PsyborgUtil.getSpeed(a.panelWidth,a._duration),l=2,m=a.index-Math.round(g*l/e),n=d>0?-1:1;m===a.index&&(n=0),console.log({newIndex:m,curIndex:a.index,direction:n}),i||(a._before(),a._transitionTo(m,PsyborgUtil.getDuration(j,k),n)),i=!1,h=!1,a.isTransition=!1}()}}),this._config.swipeable&&(e=this.stage.$el.hammer({drag_block_vertical:this._config.dragBlockVertical}),e.on("dragstart",function(a){d=a.timeStamp}),e.on("swipeleft",function(b){var c=b.timeStamp-d;a.isLast()||(i=!0,a.stop(),a.next(c,1))}),e.on("swiperight",function(b){var c=b.timeStamp-d;a.isFirst()||(i=!0,a.stop(),a.prev(c,-1))})))},reflow:function(a){var b=this;switch(a.timing){case PsycleReflowTiming.TRANSITION_END:case PsycleReflowTiming.RESIZE_START:case PsycleReflowTiming.RESIZE_END:!function(){b.container.$el.css({left:0}),b.panels.hide();var a=b.panels.$el;PsyborgCSS.restoreCSS(a),b.panelWidth=a.outerWidth(!0),a.width(b.panelWidth),b.stageWidth=b.stage.$el.width(),b._config.resizable&&b.stage.setHeight(b.panels.getHeight());var c=0,d=b.length;b.panels.removeClone();for(var e,f,g,h,i=b._config.clone;d>c;c++)if(e=b.panels.item(c+b.index),e.show(),b.repeat===PsycleRepeat.LOOP)for(e.$el.css({left:b.panelWidth*c}),h=1;i>h;h++)f=e.clone(),f.show(),f.$el.css({left:b.panelWidth*(c-b.length*h)}),g=e.clone(),g.show(),g.$el.css({left:b.panelWidth*(c+b.length*h)});else e.$el.css(b.index<=e.index?{left:b.panelWidth*c}:{left:b.panelWidth*(c-b.length)})}()}},silent:function(){},before:function(){},fire:function(){var a,b=this._duration||this._config.duration;this.animation&&this.animation.stop(),a=-1*this.panelWidth*this.vector,this.animation=$.Animation(this.container.$el[0],{left:a},{duration:b,easing:this._config.easing})},cancel:function(){},after:function(){}}}),PsycleTransition.create({fade:{init:function(){PsyborgCSS.posBase(this.container.$el),PsyborgCSS.posAbs(this.panels.$el)},reflow:function(a){switch(a.timing){case PsycleReflowTiming.TRANSITION_END:case PsycleReflowTiming.RESIZE_START:case PsycleReflowTiming.RESIZE_END:this.stage.$el.height(this.panels.$el.height()),PsyborgCSS.z(this.panels.$el,0),PsyborgCSS.z(this.panels.item(this.to).$el,10)}},silent:function(){},before:function(){},fire:function(){this.panels.item(this.to).$el.css({opacity:0}),PsyborgCSS.z(this.panels.item(this.to).$el,20),this.animation&&this.animation.stop(),this.animation=$.Animation(this.panels.item(this.to).$el[0],{opacity:1},{duration:this._config.duration})},cancel:function(){},after:function(){}}});var Psycle=function(a){function b(b,c){a.call(this,b),this.index=0,this.vector=0,this.isTransition=!1,this.isPaused=!1;var d={instanceKey:"psycle",startIndex:0,transition:"slide",duration:600,easing:"swing",delay:3e3,auto:!0,cancel:!0,repeat:PsycleRepeat.RETURN,container:">ul:eq(0)",panels:">li",currentClass:"current",delayWhenFire:0,clone:2,cols:1,rows:1,offsetX:0,offsetY:0,nearby:!1,innerFocus:!1,noFocus:!0,resizable:!1,draggable:!1,swipeable:!1,dragBlockVertical:!1,bindKeyboard:!1,showOnlyOnce:null,controller:null,marker:null,thumbnail:null,css3:!0,loopCloneLength:null,scenes:[]};this._config=$.extend(d,c);var e=b,f=e.find(this._config.container),g=f.find(this._config.panels);if(this.stage=new PsycleStage(e),this.container=new PsycleContainer(f),this.panels=new PsyclePanelList(g),this.transition=PsycleTransition.transitions[this._config.transition],null==this.transition)throw new ReferenceError("'"+this._config.transition+"' is not transition type");if((this._config.draggable||this._config.swipeable)&&!jQuery.fn.hammer&&!Hammer)throw new ReferenceError('"Hammer.js" is required when use "draggable" or "swipeable" options.');this.index=+this._config.startIndex||0,this.to=this.index,this.from=this.index,this.repeat=(""+this._config.repeat).toLowerCase(),this.length=this.panels.length,this.progressIndex=this.index,this._resizeable(),this._init(),this._silent(),this._config.auto&&this.play(),b.data(this._config.instanceKey,this)}return __extends(b,a),b.prototype.play=function(){var a=this,b=this.trigger("play");return b&&(this.timer=setTimeout(function(){a.next()},this._config.delay)),this},b.prototype.stop=function(){return clearTimeout(this.timer),this.isPaused=!0,this},b.prototype.freeze=function(){return this.animation&&this.animation.stop(),this},b.prototype.gotoPanel=function(a,b,c){"undefined"==typeof c&&(c=0);var d=this;return this.isTransition?this:(this._config.delayWhenFire?(clearTimeout(this._delayTimer),this._delayTimer=setTimeout(function(){d._transitionTo(a,b,c)},this._config.delayWhenFire)):this._transitionTo(a,b,c),this)},b.prototype.setIndex=function(a,b,c){"undefined"==typeof b&&(b=!0),"undefined"==typeof c&&(c=!1);var d=this._optimizeCounter(a);return c||d!==this.index?(this.vector=this._optimizeVector(d),this.stop(),this.from=this.index,this.to=d,this.progressIndex=a,b&&(this.index=d),!0):!1},b.prototype.prev=function(a){return this.isTransition?this:(this.gotoPanel(this.index-1,a,-1),this)},b.prototype.next=function(a){return this.isTransition?this:(this.gotoPanel(this.index+1,a,1),this)},b.prototype.reflow=function(a){return this.transition.reflow.call(this,{timing:PsycleReflowTiming.REFLOW_METHOD,data:a}),this},b.prototype.isFirst=function(){return this._isFirst(this.index)},b.prototype.isLast=function(){return this._isLast(this.index)},b.prototype.marker=function(a){for(var b,c=this,d=$("<ul />"),e=0,f=this.length;f>e;e++)b=$("<li />"),b.appendTo(d);var g=d.find("li");return this.on(PsycleEvent.PANEL_CHANGE_END,function(a){g.removeClass(c._config.currentClass),g.eq(a.data.index).addClass(c._config.currentClass)}),g.eq(this._config.startIndex).addClass(this._config.currentClass),g.on("click",function(b){c.gotoPanel($(b.target).index(),a),b.preventDefault()}),d},b.prototype.controller=function(a,b){var c=this,d=$.extend({prevClass:"prev",nextClass:"next",duration:null},b);a.on("click","."+d.prevClass,function(a){c.prev(d.duration),a.preventDefault()}),a.on("click","."+d.nextClass,function(a){c.next(d.duration),a.preventDefault()})},b.prototype._transitionTo=function(a,b,c){"undefined"==typeof c&&(c=0);var d=this;return this.isTransition=!0,this._duration=b,this.progressIndex=a,this.vector=this._optimizeVector(a,c),this.from=this.index,this.to=this._optimizeCounter(this.index+this.vector),this.stop,this._before(),this._fire(),this.animation.done(function(){d._done()}),this.animation.fail(function(){d._fail()}),this},b.prototype._optimizeVector=function(a,b){"undefined"==typeof b&&(b=0);var c,d=Math.abs(this.index-a);return c=this.repeat===PsycleRepeat.LOOP?PsyborgUtil.getloopSeriesVector(this.index,a,b,this.length):d*(this.index<a?1:-1)},b.prototype._optimizeCounter=function(a){var b,c=this.length-1;switch(this.repeat){case PsycleRepeat.LOOP:case PsycleRepeat.RETURN:b=PsyborgUtil.getloopSeriesNumber(a,this.length);break;default:b=0>a?0:a,b=c>b?b:c,(this._isFirst(b)||this._isLast(b))&&this.stop()}return b},b.prototype._isFirst=function(a){return 0===a},b.prototype._isLast=function(a){return a===this.length-1},b.prototype._resizeable=function(){var a,b=this,c=300,d=!1;$(window).on("resize",function(){d||(d=!0,b._resizeStart()),clearTimeout(a),b._resize(),a=setTimeout(function(){b._resizeEnd(),d=!1},c)})},b.prototype._getState=function(){return{index:this.index,stage:this.stage,container:this.container,panels:this.panels,stageWidth:this.stageWidth,panelWidth:this.panelWidth,length:this.length,from:this.from,to:this.to,vector:this.vector,isTransition:this.isTransition,isPaused:this.isPaused}},b.prototype._init=function(){this.transition.init.call(this),this.transition.reflow.call(this,{timing:PsycleReflowTiming.INIT}),this.trigger(PsycleEvent.INIT,this._getState())},b.prototype._silent=function(){this.transition.silent.call(this),this.transition.reflow.call(this,{timing:PsycleReflowTiming.TRANSITION_END}),this.panels.setCurrent(this.index,this._config.currentClass)},b.prototype._before=function(){this.transition.before.call(this),this.panels.resetCurrent(this._config.currentClass),this.trigger(PsycleEvent.PANEL_CHANGE_START,this._getState())},b.prototype._fire=function(){this.transition.fire.call(this)},b.prototype._cancel=function(){this.transition.cancel.call(this)},b.prototype._done=function(){this.index=this.to,this.isTransition=!1,this._after(),this._silent(),this.trigger(PsycleEvent.PANEL_CHANGE_END,this._getState()),this._config.auto&&this.play()},b.prototype._after=function(){this.transition.after.call(this)},b.prototype._fail=function(){this.stop(),this._cancel(),this.isTransition=!1,this.trigger(PsycleEvent.PANEL_CHANGE_CANCEL,this._getState())},b.prototype._resize=function(){this.transition.reflow.call(this,{timing:PsycleReflowTiming.RESIZE})},b.prototype._resizeStart=function(){this.transition.reflow.call(this,{timing:PsycleReflowTiming.RESIZE_START}),this.animation&&this.isTransition&&this.freeze()},b.prototype._resizeEnd=function(){this.transition.reflow.call(this,{timing:PsycleReflowTiming.RESIZE_END}),this.isPaused&&this._config.auto&&this.gotoPanel(this.to)},b}(PsyborgElement);jQuery.fn.psycle=function(a){return 0===this.length&&console&&console.warn&&console.warn("This jQuery object is empty."),this.each(function(){new Psycle($(this),a)})},jQuery.fn.cycle||(jQuery.fn.pc=jQuery.fn.psycle);