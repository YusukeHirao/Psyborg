/**
 * Psyborg.js - v0.3.1 r753
 * update: 2013-11-05
 * Author: Yusuke Hirao [http://www.yusukehirao.com]
 * Github: https://github.com/YusukeHirao/Psyborg
 * License: Licensed under the MIT License
 * Require: jQuery v1.10.x
 */

!function(){"use strict";var a,b=this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},c=function(){function a(a){this.defaultPrevented=!1,this.type=a,this.timeStamp=(new Date).valueOf()}return a.prototype.preventDefault=function(){this.defaultPrevented=!0},a}(),d=function(){function a(){this._listeners={}}return a.prototype.on=function(a,b){for(var c=a.split(/\s+/),d=0,e=c.length;e>d;d++)this._listeners[c[d]]=b},a.prototype.off=function(a,b){for(var c,d=a.split(/\s+/),e=0,f=d.length;f>e;e++)c=d[e],(null==b||this._listeners[c]===b)&&delete this._listeners[c]},a.prototype.trigger=function(a,b,d){"undefined"==typeof b&&(b={}),"undefined"==typeof d&&(d=this);var e;if(e=this._listeners[a]){var f=new c(a);return f.data=b,e.call(d,f),!f.defaultPrevented}return!0},a}(),e=function(){function a(){}return a.posAbs=function(a,b,c){return"undefined"==typeof b&&(b=0),"undefined"==typeof c&&(c=0),a.css({position:"absolute",top:b,left:c})},a.posBase=function(a){var b=a.css("position");return(null==b||"static"===b||""===b)&&a.css({position:"relative"}),a},a.z=function(a,b){return"undefined"==typeof b&&(b=0),a.css({zIndex:b}),a},a.isOverflowHidden=function(a){return"hidden"===a.css("overflow").toLowerCase()},a}(),f=function(a){function c(b){a.call(this),this.$el=b}return b(c,a),c.prototype.trigger=function(b,c,d){"undefined"==typeof c&&(c={}),"undefined"==typeof d&&(d=this);var e=a.prototype.trigger.call(this,b,c,d);return e&&this.$el.trigger(b,c,d),e},c}(d),g=function(){function a(){}return a.NONE="none",a.RETURN="return",a.LOOP="loop",a}(),h=function(){function a(){}return a.INIT="init",a.PANEL_CHANGE_START="panelChangeStart",a.PANEL_CHANGE_END="panelChangeEnd",a.PANEL_CHANGE_CANCEL="panelChangeCancel",a.WAIT_START="waitStart",a.WAIT_END="waitEnd",a}();!function(a){a[a.INIT=0]="INIT",a[a.TRANSITION_END=1]="TRANSITION_END",a[a.RESIZE=2]="RESIZE",a[a.RESIZE_START=3]="RESIZE_START",a[a.RESIZE_END=4]="RESIZE_END"}(a||(a={}));var i=function(a){function c(b,c,d){a.call(this,b),this.index=c,this._list=d,this.$el.attr("data-psycle-index",c)}return b(c,a),c.prototype.show=function(){return this.$el.show(),this},c.prototype.hide=function(){return this.$el.hide(),this},c.prototype.clone=function(){var a=new j(this.$el.clone(),this.index,this._list);return this.$el.after(a.$el),this._list.addClone(a),a},c}(f),j=function(a){function c(b,c,d){a.call(this,b,c,d),this.$el.addClass("__psycle_panel_clone__")}return b(c,a),c}(i),k=function(a){function c(b){a.call(this,b),this._panels=[],this._$panels=$(),this._clones=[],this.length=0;for(var c,d=0,e=b.length;e>d;d++)c=$(b[d]),this.add(c)}return b(c,a),c.prototype.setCurrent=function(a,b){return this.resetCurrent(b),this.item(a).$el.addClass(b),this},c.prototype.resetCurrent=function(a){return this.$el.removeClass(a),this},c.prototype.add=function(a){var b=this._panels.length,c=new i(a,b,this);return this._panels.push(c),this.$el=this.$el.add(a),this.length+=1,this},c.prototype.addClone=function(a){return this._clones.push(a),this},c.prototype.remove=function(a,b){return"undefined"==typeof b&&(b=!0),b&&this.$el.eq(a).remove(),this._panels.splice(a,1),this._renumbering(),this.length-=1,this},c.prototype.item=function(a){var b=this._getRealIndex(a);return this._panels[b]},c.prototype.each=function(a){for(var b,c=0,d=this._panels.length;d>c;c++)b=this._panels[c],a.call(b,b.index,b);return this},c.prototype.show=function(){return this.$el.show(),this},c.prototype.hide=function(){return this.$el.hide(),this},c.prototype.removeClone=function(){for(var a=0,b=this._clones.length;b>a;a++)this._clones[a].$el.remove();return this._clones=[],this},c.prototype._getRealIndex=function(a){var b=this._panels.length;a%=b;var c=0>a?b+a:a;return c},c.prototype._renumbering=function(){for(var a=0,b=this._panels.length;b>a;a++)this._panels[a].index=a;return b},c}(f),l=function(a){function c(){a.apply(this,arguments)}return b(c,a),c}(f),m=function(a){function c(){a.apply(this,arguments)}return b(c,a),c}(f),n=function(){function a(a,b){this.name=a,$.extend(this,b)}return a.create=function(b){var c,d;for(c in b)d=new a(c,b[c]),a.transitions[c]=d},a.transitions={},a}();n.create({slide:{init:function(){e.posBase(this.stage.$el),e.posAbs(this.container.$el),e.posAbs(this.panels.$el);var a=this.panels.$el;a.data("originStyle",a.attr("style"))},reflow:function(b){switch(b.timing){case a.TRANSITION_END:case a.RESIZE_START:case a.RESIZE_END:this.container.$el.css({left:0}),this.panels.hide();var c=this.panels.$el;c.attr("style",c.data("originStyle")),this.panelWidth=c.width(),c.width(this.panelWidth),this.stageWidth=this.stage.$el.width();var d=0,e=this.length;this.panels.removeClone();for(var f,h,i=1,j=this._config.clone;e>d;d++)if(f=this.panels.item(d+this.index),f.show(),this.repeat===g.LOOP)for(f.$el.css({left:this.panelWidth*d});j>i;i++)h=f.clone(),h.show(),h.$el.css({left:this.panelWidth*(d-this.length)*i});else this.index<=f.index?f.$el.css({left:this.panelWidth*d}):f.$el.css({left:this.panelWidth*(d-this.length)})}},silent:function(){},before:function(){},fire:function(){this.animation&&this.animation.stop(),this.animation=$.Animation(this.container.$el[0],{left:-1*this.panelWidth*this.vector},{duration:this._config.duration})},cancel:function(){},after:function(){}}});var o=function(c){function d(a,b){c.call(this,a),this.index=0,this.vector=0,this.isTransition=!1,this.isPaused=!1;var d={startIndex:0,transition:"slide",duration:600,easing:"swing",delay:3e3,auto:!0,cancel:!0,repeat:g.RETURN,container:">ul:eq(0)",panels:">li",currentClass:"current",delayWhenFire:0,clone:1,cols:1,rows:1,offsetX:0,offsetY:0,nearby:!1,innerFocus:!1,noFocus:!0,resizable:!1,bindKeyboard:!1,showOnlyOnce:null,controller:null,marker:null,thumbnail:null,css3:!0,loopCloneLength:null,scenes:[]};this._config=$.extend(d,b);var e=a,f=e.find(this._config.container),h=f.find(this._config.panels);if(this.stage=new m(e),this.container=new l(f),this.panels=new k(h),this.transition=n.transitions[this._config.transition],null==this.transition)throw new ReferenceError("'"+this._config.transition+"' is not transition type");this.index=this._config.startIndex,this.repeat=this._config.repeat,this.length=this.panels.length,this.progressIndex=this.index,this._resizeable(),this._init(),this._silent(),this._config.auto&&this.play(),a.data("psycle",this)}return b(d,c),d.prototype.play=function(){var a=this,b=this.trigger("play");return b&&(this.timer=setTimeout(function(){a.next()},this._config.delay)),this},d.prototype.stop=function(){return clearTimeout(this.timer),this},d.prototype.gotoPanel=function(a){var b=this;if(this.isTransition)return this;var c=this._optimizeCounter(a);return c===this.index?this:(this.vector=this._optimizeVector(c),this.stop(),this.isPaused=!1,this.from=this.index,this.to=c,this.progressIndex=a,this._before(),setTimeout(function(){b.isTransition=!0,b._fire(),b.animation.done(function(){b._done()}),b.animation.fail(function(){b._fail()})},this._config.delayWhenFire),this)},d.prototype.prev=function(){return this.isTransition?this:(this.gotoPanel(this.index-1),this)},d.prototype.next=function(){return this.isTransition?this:(this.gotoPanel(this.index+1),this)},d.prototype.marker=function(){for(var a,b=this,b=this,c=$("<ul />"),d=0,e=this.length;e>d;d++)a=$("<li />"),a.appendTo(c);var f=c.find("li");return this.on(h.PANEL_CHANGE_END,function(a){f.removeClass(b._config.currentClass),f.eq(a.data.index).addClass(b._config.currentClass)}),f.on("click",function(){b.gotoPanel($(this).index())}),c},d.prototype._optimizeVector=function(a){var b,c=Math.abs(this.index-a);if(this.repeat===g.LOOP){var d=a-this.length,e=a+this.length,f=Math.abs(this.index-d),h=Math.abs(this.index-e),i={};i[f]=-1,i[h]=1,i[c]=this.index<a?1:-1;var j=Math.min(c,h,f);b=i[j]*j}else b=c*(this.index<a?1:-1);return b},d.prototype._optimizeCounter=function(a){var b,c=this.length-1;switch(this.repeat){case g.LOOP:case g.RETURN:b=0>a?c+a%c+1:a,b=c>b?b:b%(c+1);break;default:b=0>a?0:a,b=c>b?b:c,(this._isFirst(b)||this._isLast(b))&&this.stop()}return b},d.prototype._isFirst=function(a){return 0===a},d.prototype._isLast=function(a){return a===this.length-1},d.prototype._resizeable=function(){var a,b=this,c=1200,d=!1;$(window).on("resize",function(){d||(d=!0,b._resizeStart()),clearTimeout(a),b._resize(),a=setTimeout(function(){b._resizeEnd(),d=!1},c)})},d.prototype._getState=function(){return{index:this.index,stage:this.stage,container:this.container,panels:this.panels,stageWidth:this.stageWidth,panelWidth:this.panelWidth,length:this.length,from:this.from,to:this.to,vector:this.vector,isTransition:this.isTransition,isPaused:this.isPaused}},d.prototype._init=function(){this.transition.init.call(this),this.transition.reflow.call(this,{timing:a.INIT}),this.trigger(h.INIT,this._getState())},d.prototype._silent=function(){this.transition.silent.call(this),this.transition.reflow.call(this,{timing:a.TRANSITION_END}),this.panels.setCurrent(this.index,this._config.currentClass)},d.prototype._before=function(){this.transition.before.call(this),this.panels.resetCurrent(this._config.currentClass),this.trigger(h.PANEL_CHANGE_START,this._getState())},d.prototype._fire=function(){this.transition.fire.call(this)},d.prototype._cancel=function(){this.transition.cancel.call(this)},d.prototype._done=function(){this.index=this.to,this.isTransition=!1,this._after(),this._silent(),this.trigger(h.PANEL_CHANGE_END,this._getState()),this._config.auto&&this.play()},d.prototype._after=function(){this.transition.after.call(this)},d.prototype._fail=function(){this.stop(),this._cancel(),this.isPaused=!0,this.trigger(h.PANEL_CHANGE_CANCEL,this._getState())},d.prototype._resize=function(){this.transition.reflow.call(this,{timing:a.RESIZE})},d.prototype._resizeStart=function(){this.transition.reflow.call(this,{timing:a.RESIZE_START}),this.animation&&this.isTransition&&(this.animation.stop(),this.stop())},d.prototype._resizeEnd=function(){this.transition.reflow.call(this,{timing:a.RESIZE_END}),this.isPaused&&this.isTransition&&this.gotoPanel(this.to)},d}(f);jQuery.fn.psycle=function(a){return new o(this,a),this}}.call(this);