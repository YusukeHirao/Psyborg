/**
 * Psyborg.js - v0.3.5 r802
 * update: 2013-11-27
 * Author: Yusuke Hirao [http://www.yusukehirao.com]
 * Github: https://github.com/YusukeHirao/Psyborg
 * License: Licensed under the MIT License
 * Require: jQuery v1.10.x
 */

!function(){"use strict";var a=this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},b=function(){function a(a){this.defaultPrevented=!1,this.type=a,this.timeStamp=(new Date).valueOf()}return a.prototype.preventDefault=function(){this.defaultPrevented=!0},a}(),c=function(){function a(){this._listeners={}}return a.prototype.on=function(a,b){for(var c=a.split(/\s+/),d=0,e=c.length;e>d;d++)this._listeners[c[d]]||(this._listeners[c[d]]=[]),this._listeners[c[d]].push(b)},a.prototype.off=function(a,b){for(var c,d=a.split(/\s+/),e=0,f=d.length;f>e;e++)c=d[e],(null==b||this._listeners[c]===b)&&delete this._listeners[c]},a.prototype.trigger=function(a,c,d){"undefined"==typeof c&&(c={}),"undefined"==typeof d&&(d=this);var e,f,g=0;if(this._listeners[a])for(f=this._listeners[a].length;f>g;g++){e=this._listeners[a][g];var h=new b(a);if(h.data=c,e.call(d,h),h.defaultPrevented)return!1}return!0},a}(),d=function(){function a(){}return a.posAbs=function(a,b,c){return"undefined"==typeof b&&(b=0),"undefined"==typeof c&&(c=0),a.css({position:"absolute",top:b,left:c})},a.posBase=function(a){var b=a.css("position");return(null==b||"static"===b||""===b)&&a.css({position:"relative"}),a},a.z=function(a,b){return"undefined"==typeof b&&(b=0),a.css({zIndex:b}),a},a.isOverflowHidden=function(a){return"hidden"===a.css("overflow").toLowerCase()},a.saveCSS=function(a){a.each(function(a,b){var c=$(b);c.data("originStyle",c.attr("style"))})},a.restoreCSS=function(a){a.each(function(a,b){var c=$(b);c.attr("style",c.data("originStyle"))})},a}(),e=function(){function a(){}return a.getSpeed=function(a,b){return a/b},a.getDuration=function(a,b){return a/b},a.getDistance=function(a,b){return a*b},a}(),f=function(b){function c(a){if(b.call(this),!a.length)throw new ReferenceError('This jQuery object is empty. Selector "'+a.selector+"\" doesn't exist.");this.$el=a}return a(c,b),c.prototype.trigger=function(a,c,d){"undefined"==typeof c&&(c={}),"undefined"==typeof d&&(d=this);var e=b.prototype.trigger.call(this,a,c,d);return e&&this.$el.trigger(a,c,d),e},c}(c),g=function(){function a(){}return a.NONE="none",a.RETURN="return",a.LOOP="loop",a}(),h=function(){function a(){}return a.INIT="init",a.PANEL_CHANGE_START="panelChangeStart",a.PANEL_CHANGE_END="panelChangeEnd",a.PANEL_CHANGE_CANCEL="panelChangeCancel",a.WAIT_START="waitStart",a.WAIT_END="waitEnd",a}(),i=function(){function a(){}return a.INIT="init",a.TRANSITION_END="transitionEnd",a.RESIZE="resize",a.RESIZE_START="resizeStart",a.RESIZE_END="resizeEnd",a.REFLOW_METHOD="reflowMethod",a}(),j=function(b){function c(a,c,d){b.call(this,a),this.index=c,this._list=d}return a(c,b),c.prototype.show=function(){return this.$el.show(),this},c.prototype.hide=function(){return this.$el.hide(),this},c.prototype.clone=function(){var a=new k(this.$el.clone(),this.index,this._list);return this.$el.after(a.$el),this._list.addClone(a),a},c}(f),k=function(b){function c(a,c,d){b.call(this,a,c,d)}return a(c,b),c}(j),l=function(b){function c(a){b.call(this,a),this._panels=[],this._$panels=$(),this._clones=[],this.length=0;for(var c,d=0,e=a.length;e>d;d++)c=$(a[d]),this.add(c)}return a(c,b),c.prototype.setCurrent=function(a,b){return this.resetCurrent(b),this.item(a).$el.addClass(b),this},c.prototype.resetCurrent=function(a){return this.$el.removeClass(a),this},c.prototype.add=function(a){var b=this._panels.length,c=new j(a,b,this);return this._panels.push(c),this.$el=this.$el.add(a),this.length+=1,this},c.prototype.addClone=function(a){return this._clones.push(a),this},c.prototype.remove=function(a,b){return"undefined"==typeof b&&(b=!0),b&&this.$el.eq(a).remove(),this._panels.splice(a,1),this._renumbering(),this.length-=1,this},c.prototype.item=function(a){var b=this._getRealIndex(a);return this._panels[b]},c.prototype.each=function(a){for(var b,c=0,d=this._panels.length;d>c;c++)b=this._panels[c],a.call(b,b.index,b);return this},c.prototype.show=function(){return this.$el.show(),this},c.prototype.hide=function(){return this.$el.hide(),this},c.prototype.removeClone=function(){for(var a=0,b=this._clones.length;b>a;a++)this._clones[a].$el.remove();return this._clones=[],this},c.prototype._getRealIndex=function(a){var b=this._panels.length;a%=b;var c=0>a?b+a:a;return c},c.prototype._renumbering=function(){for(var a=0,b=this._panels.length;b>a;a++)this._panels[a].index=a;return b},c}(f),m=function(b){function c(){b.apply(this,arguments)}return a(c,b),c}(f),n=function(b){function c(){b.apply(this,arguments)}return a(c,b),c}(f),o=function(){function a(a,b){this.name=a,$.extend(this,b)}return a.create=function(b){var c,d;for(c in b)d=new a(c,b[c]),a.transitions[c]=d},a.transitions={},a}();o.create({slide:{init:function(){var a=this;d.posBase(this.stage.$el),d.posAbs(this.container.$el),d.posAbs(this.panels.$el);var b=this.panels.$el;d.saveCSS(b);var c,f,g,h,i,j;(this._config.draggable||this._config.swipeable)&&(c=!1,g=this.stage.$el.hammer({drag_block_vertical:!0}),g.find("a, img").hammer(),g.on("tap dragstart drag dragend",function(b){switch(b.type){case"tap":c=!1;break;case"dragstart":f=a.container.$el.position().left,i=a.index;case"drag":a.freeze(),c=!0,h=(f+b.gesture.deltaX)%(a.panelWidth*a.length)-a.panelWidth*a.length;var d=-1*Math.floor(h/a.panelWidth);j=a._optimizeCounter(i+d-1),a.setIndex(j),a.container.$el.css({left:h}),a.reflow({distance:h%a.panelWidth});break;case"dragend":var g=a.panelWidth%h,k=e.getSpeed(a.panelWidth,a._duration);a.isTransition=!1,a.next(e.getDuration(g,k))}}),g.find("a").on("click",function(a){c&&(a.preventDefault(),c=!1)}))},reflow:function(a){switch(a.timing){case i.TRANSITION_END:case i.RESIZE_START:case i.RESIZE_END:case i.REFLOW_METHOD:var b=0;a.timing===i.REFLOW_METHOD&&(b=a.data.distance),this.container.$el.css({left:0+b}),this.panels.hide();var c=this.panels.$el;d.restoreCSS(c),this.panelWidth=c.outerWidth(!0),c.width(this.panelWidth),this.stageWidth=this.stage.$el.width();var e=0,f=this.length;this.panels.removeClone();for(var h,j,k,l,m=this._config.clone;f>e;e++)if(h=this.panels.item(e+this.index),h.show(),this.repeat===g.LOOP)for(h.$el.css({left:this.panelWidth*e}),l=1;m>l;l++)j=h.clone(),j.show(),j.$el.css({left:this.panelWidth*(e-this.length*l)}),k=h.clone(),k.show(),k.$el.css({left:this.panelWidth*(e+this.length*l)});else this.index<=h.index?h.$el.css({left:this.panelWidth*e}):h.$el.css({left:this.panelWidth*(e-this.length)})}},silent:function(){},before:function(){},fire:function(){var a,b=this._duration||this._config.duration;this.animation&&this.animation.stop(),a=-1*this.panelWidth*this.vector,this.animation=$.Animation(this.container.$el[0],{left:a},{duration:b,easing:this._config.easing})},cancel:function(){},after:function(){}}});var p=function(b){function c(a,c){b.call(this,a),this.index=0,this.vector=0,this.isTransition=!1,this.isPaused=!1;var d={startIndex:0,transition:"slide",duration:600,easing:"swing",delay:3e3,auto:!0,cancel:!0,repeat:g.RETURN,container:">ul:eq(0)",panels:">li",currentClass:"current",delayWhenFire:0,clone:2,cols:1,rows:1,offsetX:0,offsetY:0,nearby:!1,innerFocus:!1,noFocus:!0,resizable:!1,draggable:!1,swipeable:!1,bindKeyboard:!1,showOnlyOnce:null,controller:null,marker:null,thumbnail:null,css3:!0,loopCloneLength:null,scenes:[]};this._config=$.extend(d,c);var e=a,f=e.find(this._config.container),h=f.find(this._config.panels);if(this.stage=new n(e),this.container=new m(f),this.panels=new l(h),this.transition=o.transitions[this._config.transition],null==this.transition)throw new ReferenceError("'"+this._config.transition+"' is not transition type");if((this._config.draggable||this._config.swipeable)&&!jQuery.fn.hammer&&!Hammer)throw new ReferenceError('"Hammer.js" is required when use "draggable" or "swipeable" options.');this.index=this._config.startIndex,this.repeat=this._config.repeat,this.length=this.panels.length,this.progressIndex=this.index,this._resizeable(),this._init(),this._silent(),this._config.auto&&this.play(),a.data("psycle",this)}return a(c,b),c.prototype.play=function(){var a=this,b=this.trigger("play");return b&&(this.timer=setTimeout(function(){a.next()},this._config.delay)),this},c.prototype.stop=function(){return clearTimeout(this.timer),this.isPaused=!0,this},c.prototype.freeze=function(){return this.animation.stop(),this},c.prototype.gotoPanel=function(a,b){var c=this;return this.isTransition?this:this.setIndex(a,!1)?(this._duration=b,this._before(),setTimeout(function(){c.isTransition=!0,c._fire(),c.animation.done(function(){c._done()}),c.animation.fail(function(){c._fail()})},this._config.delayWhenFire),this):this.gotoPanel(a+1,b)},c.prototype.setIndex=function(a,b){"undefined"==typeof b&&(b=!0);var c=this._optimizeCounter(a);return c===this.index?!1:(this.vector=this._optimizeVector(c),this.stop(),this.from=this.index,this.to=c,this.progressIndex=a,b&&(this.index=c),!0)},c.prototype.prev=function(a){return this.isTransition?this:(this.gotoPanel(this.index-1,a),this)},c.prototype.next=function(a){return this.isTransition?this:(this.gotoPanel(this.index+1,a),this)},c.prototype.reflow=function(a){return this.transition.reflow.call(this,{timing:i.REFLOW_METHOD,data:a}),this},c.prototype.marker=function(){for(var a,b=this,b=this,c=$("<ul />"),d=0,e=this.length;e>d;d++)a=$("<li />"),a.appendTo(c);var f=c.find("li");return this.on(h.PANEL_CHANGE_END,function(a){f.removeClass(b._config.currentClass),f.eq(a.data.index).addClass(b._config.currentClass)}),f.eq(this._config.startIndex).addClass(this._config.currentClass),f.on("click",function(){b.gotoPanel($(this).index())}),c},c.prototype._optimizeVector=function(a){var b,c=Math.abs(this.index-a);if(this.repeat===g.LOOP){var d=a-this.length,e=a+this.length,f=Math.abs(this.index-d),h=Math.abs(this.index-e),i={};i[f]=-1,i[h]=1,i[c]=this.index<a?1:-1;var j=Math.min(c,h,f);b=i[j]*j}else b=c*(this.index<a?1:-1);return b},c.prototype._optimizeCounter=function(a){var b,c=this.length-1;switch(this.repeat){case g.LOOP:case g.RETURN:b=0>a?c+a%c+1:a,b=c>b?b:b%(c+1);break;default:b=0>a?0:a,b=c>b?b:c,(this._isFirst(b)||this._isLast(b))&&this.stop()}return b},c.prototype._isFirst=function(a){return 0===a},c.prototype._isLast=function(a){return a===this.length-1},c.prototype._resizeable=function(){var a,b=this,c=300,d=!1;$(window).on("resize",function(){d||(d=!0,b._resizeStart()),clearTimeout(a),b._resize(),a=setTimeout(function(){b._resizeEnd(),d=!1},c)})},c.prototype._getState=function(){return{index:this.index,stage:this.stage,container:this.container,panels:this.panels,stageWidth:this.stageWidth,panelWidth:this.panelWidth,length:this.length,from:this.from,to:this.to,vector:this.vector,isTransition:this.isTransition,isPaused:this.isPaused}},c.prototype._init=function(){this.transition.init.call(this),this.transition.reflow.call(this,{timing:i.INIT}),this.trigger(h.INIT,this._getState())},c.prototype._silent=function(){this.transition.silent.call(this),this.transition.reflow.call(this,{timing:i.TRANSITION_END}),this.panels.setCurrent(this.index,this._config.currentClass)},c.prototype._before=function(){this.transition.before.call(this),this.panels.resetCurrent(this._config.currentClass),this.trigger(h.PANEL_CHANGE_START,this._getState())},c.prototype._fire=function(){this.transition.fire.call(this)},c.prototype._cancel=function(){this.transition.cancel.call(this)},c.prototype._done=function(){this.index=this.to,this.isTransition=!1,this._after(),this._silent(),this.trigger(h.PANEL_CHANGE_END,this._getState()),this._config.auto&&this.play()},c.prototype._after=function(){this.transition.after.call(this)},c.prototype._fail=function(){this.stop(),this._cancel(),this.isTransition=!1,this.trigger(h.PANEL_CHANGE_CANCEL,this._getState())},c.prototype._resize=function(){this.transition.reflow.call(this,{timing:i.RESIZE})},c.prototype._resizeStart=function(){this.transition.reflow.call(this,{timing:i.RESIZE_START}),this.animation&&this.isTransition&&this.freeze()},c.prototype._resizeEnd=function(){this.transition.reflow.call(this,{timing:i.RESIZE_END}),this.isPaused&&this._config.auto&&this.gotoPanel(this.to)},c}(f);jQuery.fn.psycle=function(a){return 0===this.length&&console&&console.warn&&console.warn("This jQuery object is empty."),this.each(function(){new p($(this),a)})}}.call(this);